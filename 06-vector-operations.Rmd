# Simple operations on vectors

## Perimiter
`perim()` is used to get the perimiter of a vector:

```{r perimiter}
eu <- vect("data/EU/EU.shp")
eu[["perimeter"]] <- perim(eu) / 1e3 #in km
plot(
  eu, "perimeter",
  type = "continuous", 
  col = hcl.colors(length(eu), "Dark Mint")
)
```

(Look at Greece with all that islands!)

## Area
`expanse()` is used to calculate the area of vectors:

```{r area}
eu[["area"]] <- expanse(eu, unit = "km")
plot(
  eu, "area",
  type = "continuous",
  col = hcl.colors(length(eu), "Dark Mint")
)
```

(Sweden is smaller than what it looks)

Bonus:
```{r bonus-1}
mapped_islands <- table(disagg(eu)$NAME_ENGL)[eu$NAME_ENGL] #some magic
with(as.data.frame(eu), plot(
  perimeter, area, 
  pch = 20, cex = 2,
  col = "dodgerblue3"
))
text(
  x = eu$perimeter, y = eu$area,
  labels = eu$NAME_ENGL, 
  adj = c(0.5, -1),
)
text(
  x = eu$perimeter, y = eu$area,
  labels = paste(mapped_islands, "islands"),
  adj = c(0.5, 2),
)
```

(I call this relationship the _island factor_)

## Centroids

The centroid is the point defined as the arithmetic mean position of all the points in the surface of the polygon.
For instance, the centroids of a square polygon it's its center:
```{r centroid-square}
p <- vect(
  matrix(
    c(0, 0, 1, 0, 1, 1, 0, 1, 0, 0), byrow = TRUE, ncol = 2
  )
)
p <- as.lines(p)
p <- as.polygons(p)
centr <- centroids(p)
plot(p, col = "dodgerblue", alpha = .5)
points(centr, col = "tomato", cex = 3)
```
But the centroid of a complex polygon may not even be inside it:
```{r centroid-outside}
p <- vect(matrix(c(0, 0, 1, 0, 1, 1, 0.9, 0.1, 0, 0), byrow = TRUE, ncol = 2))
p <- as.lines(p)
p <- as.polygons(p)
centr <- centroids(p)
plot(p, col = "dodgerblue", alpha = .5)
points(centr, col = "tomato", cex = 3)
```
Neverthelss, centroids can someitmes be useful to get an idea of a process at large spatial scales.
For instance, the latitude of the centroids of the countries in the EU is somewhat their average latitude:
```{r centroid-eu}
eu_centr <- centroids(eu)
eu <- vect("data/EU/EU.shp")
plot(eu, col = "#001489", border = "white", lw = 1)
points(eu_centr, col = "#FFDD00", cex = 2, pch = 3, lw = 2)
```

## Buffer
To _buffer_ a polygon is to extend its perimeter in all directions at the same time, i.e. orthogonally to the tangent line of each point.
Buffering is achieved in `terra` using `buffer(x, width)`.
It is easier to see it than to explain it.

```{r buffer}
b <- buffer(eu, 1e5) #100km for visualizing it
plot(eu, col = "#001489")
lines(b, col = "tomato", lw = 2)
```

## Neighbors of polygons
In `terra`, neighbors of a polygon are obtained using `adjacent()`.
The output of `adjacent()` is a matrix, either of two columns with the first being the IDs of the $n$ countries or of $n \times n$ representing the adjacency matrix of the countries.
I like more the adjacency matrix, therefore:

```{r}
neigh <- as.list(rep(NA, length(eu))) #initialize empty list
names(neigh) <- eu$NAME_ENGL
adj <- adjacent(eu, pairs = FALSE)

# then a convoluted code to show the number of neighbors
for (i in seq_along(eu)) {
  ctr <- eu[adj[i, ] == 1, ]
  if(length(ctr) > 0) {
    neigh[[i]] <- unique(ctr$NAME_ENGL)
  } else {
    neigh[[i]] <- "No neighbours"
  }
}
eu$neigh <- sapply(neigh, length)
eu$neigh[sapply(neigh, \(x) all(x == "No neighbours"))] <- 0
plot(
  eu, "neigh", 
  col = hcl.colors(max(eu$neigh) + 1, "Dark Mint")
)
```

(Germany truly is the hearth of the EU)
